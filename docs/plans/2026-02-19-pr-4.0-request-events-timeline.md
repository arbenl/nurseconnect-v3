# PR-4.0 Request Events Timeline Plan

## Scope
- Add append-only `service_request_events` audit log for service request lifecycle.
- Record created/assigned/request lifecycle transitions in the same DB transaction as state changes.
- Expose timeline endpoint for authorized actors:
  - `GET /api/requests/[id]/events`
- Add DB integration and API E2E coverage.

## Event Model
- Columns:
  - `id` (serial PK)
  - `request_id` (`uuid`, FK to `service_requests`, cascade on delete)
  - `type` (`request_created | request_assigned | request_accepted | request_rejected | request_enroute | request_completed | request_canceled`)
  - `actor_user_id` (`uuid`, nullable FK to `users`, set null on delete)
  - `from_status` / `to_status` (`service_request_status`, nullable)
  - `meta` (`jsonb`)
  - `created_at` (`timestamptz`, default now)
- Index:
  - `(request_id, id)` for stable ordering

## Implementation Checklist
1. Add schema + migration and snapshot entries.
2. Add request event contract types in `packages/contracts/src/request-events.ts`.
3. Add write helpers in `apps/web/src/server/requests/request-events.ts`.
4. Add writes from:
   - `createAndAssignRequest` (`request_created`, optional `request_assigned`)
   - `applyRequestAction` (accepted/rejected/enroute/completed/canceled)
5. Add endpoint:
   - `apps/web/src/app/api/requests/[id]/events/route.ts`
   - authorized for patient owner, assigned nurse, and admin
6. Add DB and API E2E tests proving ordered timeline.
